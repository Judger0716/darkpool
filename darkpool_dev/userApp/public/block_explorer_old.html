<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- CDN INSTALL Vue-->
    <script src="https://unpkg.com/vue@2.6.12/dist/vue.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.14.1/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui@2.14.1/lib/index.js"></script>
    <script src="https://unpkg.com/axios@0.21.0/dist/axios.min.js"></script>
    <!-- LOCAL INSTALL
        <script src="../static/vue.js"></script>
        <link rel="stylesheet" href="../static/index.css">
        <script src="../static/index.js"></script>
        <script src="../static/axios.min.js"></script>
    -->

    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>BlockExplorer</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="enroutedigitallab">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Font -->
    <link
        href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i%7CRoboto:300,300i,400,400i,500,500i,700,700i"
        rel="stylesheet">
    <!-- Bootstrap css-->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <!-- Font Awesome css-->
    <!--<link rel="stylesheet" href="/public/css/font-awesome.min.css">-->
    <link rel="stylesheet" href="/public/css/ionicons.min.css">
    <!-- animate css-->
    <link rel="stylesheet" href="/public/css/animate.min.css">
    <!-- REVOLUTION SLIDER STYLES -->
    <link rel="stylesheet" type="text/css" href="/public/css/settings.css">
    <link rel="stylesheet" type="text/css" href="/public/css/layers.css">
    <link rel="stylesheet" type="text/css" href="/public/css/navigation.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="/public/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/public/css/owl.theme.default.min.css">
    <!-- custom menu css-->
    <link rel="stylesheet" href="/public/css/custom-menu.css">
    <!-- c3 min css-->
    <link rel="stylesheet" href="/public/css/c3.min.css">
    <!-- Style css-->
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- Responsive css-->
    <link rel="stylesheet" href="/public/css/responsive.css">
    <!-- Modernizr js-->
    <script src="/public/js/modernizr-2.8.3.min.js"></script>

    <style>
        * {
            font-family: 'Roboto', serif;
        }

        .demo-table-expand {
            font-size: 0;
        }

        .demo-table-expand label {
            width: 90px;
            color: #99a9bf;
        }

        .demo-table-expand .el-form-item {
            margin-right: 0;
            margin-bottom: 0;
            width: 100%;
        }

        .el-form-item__label {
            margin-bottom: 0;
        }

        .el-tooltip__popper {
            max-width: 1200px;
        }
    </style>


</head>

<body>

    <!--Preloader-->
    <div class="preloader">
        <div class="loading"></div>
    </div>
    <!--/.preloader-->

    <!--header-->
    <header class="stricky">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <nav id="cssmenu">
                        <div class="logo">
                            <a href="/"><img src="/public/images/logo.png" alt=""></a>
                        </div>
                        <div id="head-mobile"></div>
                        <div class="button"></div>
                        <ul class="pull-right header-list">
                            <li><a href="/"><span class="glyphicon glyphicon-home"></span>首页</a></li>
                            <li><a href="/public/kline/basic.html"><span
                                        class="glyphicon glyphicon glyphicon-stats"></span>查看行情</a></li>
                            <li><a href="/public/tutorial.html"><span
                                        class="glyphicon glyphicon-info-sign"></span>快速入门</a></li>
                            <li><a href="/public/block_explorer.html"><span
                                        class="glyphicon glyphicon-globe"></span>区块浏览</a></li>
                            <li><a href="#" onClick="javascript :history.back(-1);"><span
                                        class="glyphicon glyphicon-backward"></span>返回</a></li>
                        </ul>
                        <!--/.pull-right-->
                    </nav>
                    <!--/#cssmenu-->
                </div>
            </div>
        </div>
    </header>
    <!--/header-->

    <div class="banner-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="banner-title text-center">
                        <h2 style="font-family: Lora, serif; font-weight: 700;">区块信息浏览</h2>
                        <h2 style="font-family: Lora, serif; font-weight: 700; font-size: medium;">HyperLedger Fabric
                            区块信息浏览</h2>
                    </div>
                </div>
            </div>
            <!--/.row-->
        </div>
        <!--/.container-->
    </div>
    <!--/.banner-section-->

    <section class="section-padding">
        <div class="container">
            <div class="row">
                <div class="col-md-12" id="explorer">
                    <el-table :data="block_list.slice((currentPage-1)*pageSize,currentPage*pageSize)"
                        style="width: 100%">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="通道ID">
                                        <span>{{ props.row.data.payload.header.channel_header.channel_id }}</span>
                                    </el-form-item>
                                    <el-form-item label="交易ID">
                                        <span v-if="props.row.data.payload.header.channel_header.tx_id">{{
                                            props.row.data.payload.header.channel_header.tx_id }}</span>
                                        <span v-else>无</span>
                                    </el-form-item>
                                    <el-form-item label="Extension">
                                        <span v-if="props.row.data.payload.header.channel_header.extension">{{
                                            props.row.data.payload.header.channel_header.extension }}</span>
                                        <span v-else>无</span>
                                    </el-form-item>
                                    <el-form-item label="TypeString">
                                        <span>{{ props.row.data.payload.header.channel_header.typeString }}</span>
                                    </el-form-item>
                                    <el-form-item label="签名创建者">
                                        <span v-if="props.row.data.payload.header.signature_header.creator.mspid">{{
                                            props.row.data.payload.header.signature_header.creator.mspid }}</span>
                                        <span v-else>无</span>
                                    </el-form-item>
                                    <el-form-item label="Endorser" v-for="eds in props.row.endorser">
                                        <span>mspid: {{ eds.mspid }}</span><br>
                                        <span>signature: {{ eds.signature }}</span>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column label="区块高度" prop="blockNumber" width="50"></el-table-column>
                        <el-table-column label="时间" prop="data.payload.header.channel_header.timestamp" width="100">
                        </el-table-column>
                        <el-table-column label="随机数" prop="data.payload.header.signature_header.nonce" width="100">
                        </el-table-column>
                        <el-table-column label="区块头">
                            <el-table-column label="前一区块哈希" prop="header.previous_hash"></el-table-column>
                            <el-table-column label="区块数据哈希" prop="header.data_hash"></el-table-column>
                        </el-table-column>
                        <el-table-column label="区块数据签名(详细点击左侧查看)" prop="data.signature"></el-table-column>
                        <el-table-column align="center" label="区块事件">
                            <el-table-column align="center" label="数目" prop="events.length" width="50%">
                            </el-table-column>
                            <el-table-column align="center" label="内容">
                                <template slot-scope="scope">
                                    <el-button icon="el-icon-document" type="text" v-if="scope.row.events.length > 0"
                                        @click="scope.row.show_events = true;">
                                        查看事件</el-button>
                                    <div v-else>无事件</div>
                                    <el-dialog title="事件信息" v-if="scope.row.events.length > 0" :append-to-body="true"
                                        :visible.sync="scope.row.show_events" center>

                                        <el-table :data="scope.row.events">
                                            <el-table-column align="center" prop="name" label="事件名" width="100%">
                                            </el-table-column>
                                            <el-table-column align="center" label="事件内容" prop="payload"
                                                show-overflow-tooltip>
                                            </el-table-column>
                                        </el-table>

                                        <span slot="footer" class="dialog-footer" center>
                                            <el-button type="primary" @click="scope.row.show_events = false;">确定
                                            </el-button>
                                        </span>
                                    </el-dialog>
                                </template>
                            </el-table-column>
                        </el-table-column>
                    </el-table>
                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange"
                        :current-page="currentPage" :page-sizes="[10, 20, 30, 50, 100]" :page-size="pageSize"
                        layout="total, sizes, prev, pager, next, jumper" :total="block_list.length">
                    </el-pagination>
                </div>
            </div>
        </div>
    </section>
    <!--/.section-padding-->

    <section class="footer-area">
        <div class="container">
            <div class="row footer-banner row-eq-height">
                <div class="col-md-6 col-sm-6">
                    <div class="footer-content">
                        <div class="footer-logo">
                            <a href="/"><img src="/public/images/footer-logo.png" alt=""></a>
                        </div>
                        <div class="text-content">
                            <p>本平台致力于打造全球规模最大的暗池交易系统</p>
                            <p>加入CryptoPool，成为我们的一员</p>
                        </div>
                    </div>
                    <!--/.footer-content-->
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="footer-content">
                        <h4><a href="#">最近要闻</a></h4>
                        <ul>
                            <li><a href="#">平台动态</a></li>
                            <li><a href="#">市场快报</a></li>
                            <li><a href="#">投资建议</a></li>
                            <li><a href="#">商业合作</a></li>
                        </ul>
                    </div>
                    <!--/.footer-content-->
                </div>
                <div class="col-md-3 col-sm-6 col-xs-6">
                    <div class="footer-content">
                        <h4><a href="#">友情链接</a></h4>
                        <ul>
                            <li><a href="/public/tutorial.html">快速入门</a></li>
                            <li><a href="/public/kline/basic.html">查看行情</a></li>
                            <li><a href="/public/block_explorer.html">区块浏览</a></li>
                            <li><a href="#">联系我们</a></li>
                        </ul>
                    </div>
                    <!--/.footer-content-->
                </div>
            </div>
            <!--/.rwo footer-banner-->
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 col-sm-6">
                        <div class="copyright-info">
                            <p>Copyright &copy; 2021.CryptoPool All rights reserved.</p>
                        </div>
                    </div>
                    <!--/.copyright-info-->
                    <div class="col-md-6 col-sm-6">
                        <div class="social text-right content-align">
                            <ul>
                                <li><a href="#"><i><img src="/public/images/footer/wechat.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/alipay.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/weibo.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/facebook.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/twitter.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/ins.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                            </ul>
                        </div>
                        <!--/.social-->
                    </div>
                </div>
            </div>
            <!--/.copyright-->
        </div>
        <!--/.contianer-->
    </section>
    <!--/.footer area-->

    <!-- == jQuery Librery == -->
    <script src="/public/js/jquery-3.3.1.min.js"></script>
    <!-- == Bootsrap js File == -->
    <script src="/public/js/bootstrap.min.js"></script>
    <!-- == wow min js == -->
    <script src="/public/js/wow.min.js"></script>
    <!-- == Custom Menu js == -->
    <script src="/public/js/custom-menu.js"></script>
    <!-- == Custom Counter js == -->
    <script src="/public/js/custom-counter.js"></script>
    <!-- == Prallex js == -->
    <script src="/public/js/prallex.js"></script>
    <!-- == Chart min js == -->
    <script src="/public/js/Chart.min.js"></script>
    <!-- == chat Active js == -->
    <script src="/public/js/active-chart.js"></script>
    <!-- == Owl Carousel  == -->
    <script src="/public/js/owl.carousel.min.js"></script>
    <!-- == Custom js  == -->
    <script src="/public/js/custom.js"></script>

    <script>
        var explorer = new Vue({
            el: "#explorer",
            data: {
                node_list: [],
                block_list: [],
                // 控制参数
                currentPage: 1, // 查询结果当前页
                currentOrderPage: 1,
                currentDealedOrderPage: 1,
                pageSize: 10, // 查询结果每页多少条
            },
            methods: {
                log(obj) {
                    console.log(obj);
                },
                // 查询转账信息
                query_block() {
                    axios.post('/query_block', {
                        num: 100
                    }).then(Response => {
                        // console.log(Response['data']['block_list']);
                        if (Response['data']['block_list'].length > 0) {
                            this.block_list = this.block_list.concat(Response['data']['block_list']);
                            // setTimeout(this.query_block, 1000);
                        } else {
                            // setTimeout(this.query_block, 500);
                        }
                    }).catch(function (error) {
                        console.log(error);
                    })
                },
                // 每页多少条
                handleSizeChange(val) {
                    this.pageSize = val;
                },
                // 当前页
                handleCurrentChange(val) {
                    this.currentPage = val;
                },
            },
            created: function () {
                this.query_block();
            }
        })
    </script>

</body>

</html>