<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- CDN INSTALL Vue-->
    <script src="https://unpkg.com/vue@2.6.12/dist/vue.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.14.1/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui@2.14.1/lib/index.js"></script>
    <script src="https://unpkg.com/axios@0.21.0/dist/axios.min.js"></script>
    <!-- LOCAL INSTALL
        <script src="../static/vue.js"></script>
        <link rel="stylesheet" href="../static/index.css">
        <script src="../static/index.js"></script>
        <script src="../static/axios.min.js"></script>
        -->
    <title>Data</title>

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="enroutedigitallab">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Font -->
    <link
        href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i%7CRoboto:300,300i,400,400i,500,500i,700,700i"
        rel="stylesheet">
    <!-- Bootstrap css-->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <!-- Font Awesome css-->
    <!--<link rel="stylesheet" href="/public/css/font-awesome.min.css">-->
    <link rel="stylesheet" href="/public/css/ionicons.min.css">
    <!-- animate css-->
    <link rel="stylesheet" href="/public/css/animate.min.css">
    <!-- REVOLUTION SLIDER STYLES -->
    <link rel="stylesheet" type="text/css" href="/public/css/settings.css">
    <link rel="stylesheet" type="text/css" href="/public/css/layers.css">
    <link rel="stylesheet" type="text/css" href="/public/css/navigation.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="/public/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/public/css/owl.theme.default.min.css">
    <!-- custom menu css-->
    <link rel="stylesheet" href="/public/css/custom-menu.css">
    <!-- Style css-->
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- Responsive css-->
    <link rel="stylesheet" href="/public/css/responsive.css">
    <!-- Modernizr js-->
    <script src="/public/js/modernizr-2.8.3.min.js"></script>

    <link rel="stylesheet" href="/public/css/xterm.css" />
    <script src="/public/js/xterm.js"></script>

    <style>
        * {
            font-family: 'Roboto', serif;
        }

        .el-form-item__label {
            color: #F3CF33;
            text-shadow: 0px 0px 1px white;
            font-weight: bold;
            font-size: 18px;
            width: 200px;
        }

        .item .el-form-item__label {
            margin-top: 4px;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #919399;
            border-radius: 8px;
        }
    </style>

</head>

<!-- 首页主体 -->

<body>
    <!-- 暗池交易 -->
    <div id="darkpool">

        <!--Preloader-->
        <div class="preloader">
            <div class="loading"></div>
        </div>
        <!--/.preloader-->

        <!-- 页面顶部 -->
        <!--header-->
        <header class="stricky">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <nav id="cssmenu">
                            <!-- logo -->
                            <div class="logo">
                                <a href="/"><img src="/public/images/logo.png" alt=""></a>
                            </div>
                            <div id="head-mobile"></div>
                            <div class="button"></div>
                            <!-- 顶部跳转按钮 -->
                            <ul class="pull-right header-list">
                                <li><a href="/"><span class="glyphicon glyphicon-home"></span>首页</a></li>
                                <!-- 20220718 -->
                                <li><a href="/public/incentive.html"><span
                                    class="glyphicon glyphicon-info-sign"></span>激励机制</a></li>
                                <!-- 20220719 -->
                                <li><a href="/public/data.html"><span
                                    class="glyphicon glyphicon-stats"></span>数据展示</a></li>
                                <!-- 20220719 <li><a href=" /public/kline/basic.html"><span
                                            class="glyphicon glyphicon glyphicon-stats"></span>查看行情</a></li> -->
                                <li><a href="/public/block_explorer.html"><span
                                            class="glyphicon glyphicon-globe"></span>区块浏览</a></li>
                                <li><a href="#" onClick="javascript :history.back(-1);"><span
                                    class="glyphicon glyphicon-backward"></span>返回</a></li>
                            </ul>
                            <!--/.pull-right-->
                        </nav>
                        <!--/#cssmenu-->
                    </div>
                </div>
            </div>
        </header>
        <!--/header-->

        <div class="banner-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="banner-title text-center">
                            <h2 style="font-family: Lora, serif; font-weight: 700;">跨链交易数据展示</h2>
                        </div>
                    </div>
                </div>
                <!--/.row-->
            </div>
            <!--/.container-->
        </div>
        <!--/.banner-section-->

        <!-- 订单查询 -->
        <a href="#" name="order_query"></a>
        <section class="section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="section-head text-center">
                            <h2>订单查询</h2>
                            <el-button @click="get_order()">查询订单的详细信息</el-button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <el-table :data="order_list.slice((currentOrderPage-1)*pageSize,currentOrderPage*pageSize)"
                            style="width: 100%" :default-sort = "{prop: 'order_id', order: 'descending'}">
                            <el-table-column prop="order_id" label="订单编号" width="100"></el-table-column>
                            <!-- 20220719 -->
                            <el-table-column prop="creator_addr" label="创建者" width="150" min-width="280" :show-overflow-tooltip="true" ></el-table-column>
                            <el-table-column prop="create_time" label="创建时间" width="95"></el-table-column>
                            <el-table-column prop="type" label="订单类型" width="100"></el-table-column>
                            <el-table-column prop="item" label="交易物品" width="100"></el-table-column>
                            <el-table-column prop="amount" label="交易数量" width="100"></el-table-column>
                            <!-- 展示shares 20220720 -->
                            <el-table-column align="center" label="订单碎片">
                                <template slot-scope="sh">
                                    <el-table :data="sh.row.shares">
                                        <el-table-column align="center" prop="name" label="用户名" width="80%"></el-table-column>
                                        <el-table-column align="center" prop="seq" label="序号" width="60%"></el-table-column>
                                        <el-table-column align="center" prop="data" label="内容" min-width="50" show-overflow-tooltip></el-table-column>
                                    </el-table>
                                </template>
                            </el-table-column>
                            <!-- 
                            <el-table-column label="订单碎片" width="150%">
                                <template slot-scope="scope">
                                    <el-button icon="el-icon-document" type="text"
                                        @click="scope.row.share_info_visible = true;">查看订单碎片</el-button>
                                    <el-dialog title="订单碎片信息" :append-to-body="true"
                                        :visible.sync="scope.row.share_info_visible" center>
                                        <el-table :data="order_list[scope.$index].shares">
                                            <el-table-column align="center" prop="name" label="用户名" width="80%"></el-table-column>
                                            <el-table-column align="center" label="碎片">
                                                <el-table-column align="center" prop="seq" label="序号" width="60%"></el-table-column>
                                                <el-table-column align="center" prop="data" label="内容" show-overflow-tooltip></el-table-column>
                                            </el-table-column>
                                        </el-table>

                                        <span slot="footer" class="dialog-footer" center>
                                            <el-button type="primary" @click="scope.row.share_info_visible = false">确 定
                                            </el-button>
                                        </span>
                                    </el-dialog>
                                </template>
                            </el-table-column>-->
                        </el-table>
                        <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange_order"
                            :current-page="currentOrderPage" :page-sizes="[10, 20, 30, 50, 100]" :page-size="pageSize"
                            layout="total, sizes, prev, pager, next, jumper" :total="order_list.length">
                        </el-pagination>
                    </div>
                </div>
            </div>
        </section>
        <!--/.section-padding-->

        <!-- 查询匹配交易 -->
        <a href="#" name='dealed_order_query'></a>
        <section class="section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="section-head text-center">
                            <h2>查询匹配交易</h2>
                            <el-button @click="get_dealed_order()">查询</el-button>
                        </div>
                    </div>
                </div>
                <div class="row row-eq-height">
                    <el-table
                        :data="dealed_order_list.slice((currentDealedOrderPage-1)*pageSize,currentDealedOrderPage*pageSize)"
                        style="width: 100%" :default-sort = "{prop: 'deal_id', order: 'descending'}">
                        <el-table-column label="成交序号" prop="deal_id" width="100"></el-table-column>
                        <el-table-column label="成交物品" prop="item" width="100"></el-table-column>
                        <el-table-column label="成交价格" prop="deal_price" width="100"></el-table-column>
                        <el-table-column label="成交时间" prop="deal_time" width="200"></el-table-column>
                        <el-table-column label="买单信息" width="150">
                            <template slot-scope="scope">
                                <el-popover placement="top" width="600" trigger="click">
                                    <el-table :data="scope.row.buy_order" stripe style="width: 100%">
                                        <el-table-column prop="order_id" label="订单序号" width="100"></el-table-column>
                                        <!-- 20220719 
                                        <el-table-column prop="creator" label="买家" width="100"></el-table-column>
                                        -->
                                        <el-table-column prop="creator_addr" label="买家" width="100" min-width="100" :show-overflow-tooltip="true"></el-table-column>
                                        <el-table-column prop="item" label="交易物品" width="100"></el-table-column>
                                        <el-table-column prop="amount" label="交易数量" width="100"></el-table-column>
                                        <el-table-column prop="create_time" label="创建时间" width="95"></el-table-column>
                                    </el-table>
                                    <el-button slot="reference">点击查看</el-button>
                                </el-popover>
                            </template>
                        </el-table-column>
                        <el-table-column label="卖单信息" width="150">
                            <template slot-scope="scope">
                                <el-popover placement="top" width="600" trigger="click">
                                    <el-table :data="scope.row.sell_order" stripe style="width: 100%">
                                        <el-table-column prop="order_id" label="订单序号" width="100"></el-table-column>
                                        <!-- 20220719 
                                        <el-table-column prop="creator" label="买家" width="100"></el-table-column>
                                        -->
                                        <el-table-column prop="creator_addr" label="卖家" width="100" min-width="100" :show-overflow-tooltip="true"></el-table-column>
                                        <el-table-column prop="item" label="交易物品" width="100"></el-table-column>
                                        <el-table-column prop="amount" label="交易数量" width="100"></el-table-column>
                                        <el-table-column prop="create_time" label="创建时间" width="95"></el-table-column>
                                    </el-table>
                                    <el-button slot="reference">点击查看</el-button>
                                </el-popover>
                            </template>
                        </el-table-column>
                        <el-table-column label="相关委员">
                            <template slot-scope="props">
                                <div v-for="comm in props.row.related_comm" style="display:inline">
                                    {[ comm ]}
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column label="交易费" prop="fee" width="100"></el-table-column>
                    </el-table>
                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange_dealed_order"
                        :current-page="currentDealedOrderPage" :page-sizes="[10, 20, 30, 50, 100]" :page-size="pageSize"
                        layout="total, sizes, prev, pager, next, jumper" :total="dealed_order_list.length">
                    </el-pagination>
                </div>
                <!--/.row-->
            </div>
            <!--/.container-->
        </section>
        <!--/.team-section-->

        <section class="footer-area">
            <div class="container">
                <div class="row footer-banner row-eq-height">
                    <div class="col-md-6 col-sm-6">
                        <div class="footer-content">
                            <div class="footer-logo">
                                <a href="/"><img src="/public/images/footer-logo.png" alt=""></a>
                            </div>
                            <div class="text-content">
                                <p>本平台致力于打造全球规模最大的暗池交易系统</p>
                                <p>加入CryptoPool，成为我们的一员</p>
                            </div>
                        </div>
                        <!--/.footer-content-->
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="footer-content">
                            <h4><a href="#">最近要闻</a></h4>
                            <ul>
                                <li><a href="#">平台动态</a></li>
                                <li><a href="#">市场快报</a></li>
                                <li><a href="#">投资建议</a></li>
                                <li><a href="#">商业合作</a></li>
                            </ul>
                        </div>
                        <!--/.footer-content-->
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-6">
                        <div class="footer-content">
                            <h4><a href="#">友情链接</a></h4>
                            <ul>
                                <li><a href="/public/tutorial.html">快速入门</a></li>
                                <li><a href="/public/kline/basic.html">查看行情</a></li>
                                <li><a href="/public/block_explorer.html">区块浏览</a></li>
                                <li><a href="#">联系我们</a></li>
                            </ul>
                        </div>
                        <!--/.footer-content-->
                    </div>
                </div>
                <!--/.rwo footer-banner-->
                <div class="copyright">
                    <div class="row">
                        <div class="col-md-6 col-sm-6">
                            <div class="copyright-info">
                                <p>Copyright &copy; 2021.CryptoPool All rights reserved.</p>
                            </div>
                        </div>
                        <!--/.copyright-info-->
                        <div class="col-md-6 col-sm-6">
                            <div class="social text-right content-align">
                                <ul>
                                    <li><a href="#"><i><img src="/public/images/footer/wechat.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                    <li><a href="#"><i><img src="/public/images/footer/alipay.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                    <li><a href="#"><i><img src="/public/images/footer/weibo.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                    <li><a href="#"><i><img src="/public/images/footer/facebook.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                    <li><a href="#"><i><img src="/public/images/footer/twitter.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                    <li><a href="#"><i><img src="/public/images/footer/ins.png"
                                                    style="height: 18px; width: 18px;"></i></a></li>
                                </ul>
                            </div>
                            <!--/.social-->
                        </div>
                    </div>
                </div>
                <!--/.copyright-->
            </div>
            <!--/.contianer-->
        </section>
        <!--/.footer area-->
    </div><!-- vue darkpool -->

    <!-- Vue -->
    <script>
        // 暗池交易系统
        var dp = new Vue({
            el: "#darkpool",
            delimiters: ["{[", "]}"],
            data: {
                tokenList: ['btc','eth','ltc','doge','ada','atom','dcr'], // 20220719 Front
                priceList: {
                    'btc': {
                        price: 22290, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 2.16,  // 涨跌幅
                    },
                    'eth': {
                        price: 1456.44, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 1.38,  // 涨跌幅
                    },
                    'ltc': {
                        price: 58.53, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 0.01,  // 涨跌幅
                    },
                    'doge': {
                        price: 0.06, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 0.47,  // 涨跌幅
                    },
                    'ada': {
                        price: 0.47, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 0.79,  // 涨跌幅
                    },
                    'atom':{
                        price: 9.53, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 1.63,  // 涨跌幅
                    },
                    'dcr':{
                        price: 24.73, // 兑换美元
                        isup: true,  // 涨/跌
                        rate: 0.05,  // 涨跌幅
                    }
                },

                dealed_order_list: [],  // 匹配订单信息
                order_list: [],  // 订单信息

                // 控制参数
                currentPage: 1, // 查询结果当前页
                currentOrderPage: 1,
                currentDealedOrderPage: 1,
                pageSize: 10, // 查询结果每页多少条
                elect_visible: false,
            },
            methods: {
                // 订单显示过滤器，按用户名
                filterHandler(value, row, column) {
                    return row['creator'] === this.username;
                },
                // 查询订单信息
                get_order() {
                    axios.get('/updateOrder').then(Response => {
                        this.order_list = Response['data']['OrderList']
                        // this.order_list.reverse()
                    })
                },
                // 查询匹配交易信息
                get_dealed_order() {
                    axios.get('/updateDealedOrder').then(Response => {
                        this.dealed_order_list = Response['data']['DealedOrderList']
                    })
                },
                // 每页多少条
                handleSizeChange(val) {
                    this.pageSize = val;
                },
                // 当前页
                handleCurrentChange(val) {
                    this.currentPage = val;
                },
                // 当前页
                handleCurrentChange_order(val) {
                    this.currentOrderPage = val;
                },
                // 当前页
                handleCurrentChange_dealed_order(val) {
                    this.currentDealedOrderPage = val;
                },
                // 碎片表格合并
                objectSpanMethod({ row, column, rowIndex, columnIndex }) {
                    if (columnIndex === 0) {
                        if (rowIndex % 2 === 0) {
                            return {
                                rowspan: 2,
                                colspan: 1
                            };
                        } else {
                            return {
                                rowspan: 0,
                                colspan: 0
                            };
                        }
                    }
                }
            },
            created: function () {
                var that = this;
                that.get_order();
                that.get_dealed_order();
                // setInterval不会清除定时器队列，每重复执行1次都会导致定时器叠加 \
                window.setInterval(() => {
                    // setTimeout是自带清除定时器
                    setTimeout(function () {
                        that.get_order();
                        that.get_dealed_order();
                    }, 2000)
                }, 2000)
            }
        });

        //
    </script>

    <!-- == jQuery Librery == -->
    <script src="/public/js/jquery-3.3.1.min.js"></script>
    <!-- == Bootsrap js File == -->
    <script src="/public/js/bootstrap.min.js"></script>
    <!-- == wow min js == -->
    <script src="/public/js/wow.min.js"></script>
    <!-- == Custom Menu js == -->
    <script src="/public/js/custom-menu.js"></script>
    <!-- == Custom Counter js == -->
    <script src="/public/js/custom-counter.js"></script>
    <script src="/public/js/Chart.min.js"></script>
    <script src="/public/js/active-chart.js"></script>
    <!-- == Prallex js == -->
    <script src="/public/js/prallex.js"></script>
    <!-- == Owl Carousel  == -->
    <script src="/public/js/owl.carousel.min.js"></script>
    <!-- == Revolution Slider JS == -->
    <script src="/public/js/revolution/jquery.themepunch.tools.min.js"></script>
    <script src="/public/js/revolution/jquery.themepunch.revolution.min.js"></script>
    <script src="/public/js/revolution/extensions/revolution.extension.actions.min.js"></script>
    <script src="/public/js/revolution/extensions/revolution.extension.layeranimation.min.js"></script>
    <script src="/public/js/revolution/extensions/revolution.extension.navigation.min.js"></script>
    <script src="/public/js/revolution/extensions/revolution.extension.parallax.min.js"></script>
    <script src="/public/js/revolution/extensions/revolution.extension.slideanims.min.js"></script>
    <script src="/public/js/revolution-active.js"></script>
    <!-- == Custom js  == -->
    <script src="/public/js/custom.js"></script>

</body>

</html>