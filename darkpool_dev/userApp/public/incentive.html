<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- CDN INSTALL Vue-->
    <script src="https://unpkg.com/vue@2.6.12/dist/vue.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.14.1/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui@2.14.1/lib/index.js"></script>
    <script src="https://unpkg.com/axios@0.21.0/dist/axios.min.js"></script>
    <!-- LOCAL INSTALL
        <script src="../static/vue.js"></script>
        <link rel="stylesheet" href="../static/index.css">
        <script src="../static/index.js"></script>
        <script src="../static/axios.min.js"></script>
        -->

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- ECharts -->
    <script src="../public/js/echarts.min.js"></script>

    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Incentive</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="enroutedigitallab">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Font -->
    <link
        href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i%7CRoboto:300,300i,400,400i,500,500i,700,700i"
        rel="stylesheet">
    <!-- Bootstrap css-->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <!-- Font Awesome css-->
    <!--<link rel="stylesheet" href="/public/css/font-awesome.min.css">-->
    <link rel="stylesheet" href="/public/css/ionicons.min.css">
    <!-- animate css-->
    <link rel="stylesheet" href="/public/css/animate.min.css">
    <!-- REVOLUTION SLIDER STYLES -->
    <link rel="stylesheet" type="text/css" href="/public/css/settings.css">
    <link rel="stylesheet" type="text/css" href="/public/css/layers.css">
    <link rel="stylesheet" type="text/css" href="/public/css/navigation.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="/public/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/public/css/owl.theme.default.min.css">
    <!-- custom menu css-->
    <link rel="stylesheet" href="/public/css/custom-menu.css">
    <!-- Style css-->
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- Responsive css-->
    <link rel="stylesheet" href="/public/css/responsive.css">
    <!-- Modernizr js-->
    <script src="/public/js/modernizr-2.8.3.min.js"></script>
</head>

<body>

    <!--Preloader-->
    <div class="preloader">
        <div class="loading"></div>
    </div>
    <!--/.preloader-->

    <!--header-->
    <header class="stricky">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <nav id="cssmenu">
                        <div class="logo">
                            <a href="/"><img src="/public/images/logo.png" alt=""></a>
                        </div>
                        <div id="head-mobile"></div>
                        <div class="button"></div>
                        <ul class="pull-right header-list">
                            <li><a href="/"><span class="glyphicon glyphicon-home"></span>首页</a></li>
                            <!-- 20220718 -->
                            <li><a href="/public/incentive.html"><span
                                class="glyphicon glyphicon-info-sign"></span>激励机制</a></li>
                            <!-- 20220719 -->
                            <li><a href="/public/data.html"><span
                                class="glyphicon glyphicon-stats"></span>数据展示</a></li>
                            <!-- 20220719 <li><a href="/public/kline/basic.html"><span
                                        class="glyphicon glyphicon glyphicon-stats"></span>查看行情</a></li>
                            <li><a href="/public/tutorial.html"><span
                                        class="glyphicon glyphicon-info-sign"></span>快速入门</a></li>-->
                            <li><a href="/public/block_explorer.html"><span
                                        class="glyphicon glyphicon-globe"></span>区块浏览</a></li>
                            <li><a href="#" onClick="javascript :history.back(-1);"><span
                                        class="glyphicon glyphicon-backward"></span>返回</a></li>
                        </ul>
                        <!--/.pull-right-->
                    </nav>
                    <!--/#cssmenu-->
                </div>
            </div>
        </div>
    </header>
    <!--/header-->

    <div class="banner-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="banner-title text-center">
                        <h2 style="font-family: Lora, serif; font-weight: 700;">激励机制的链搬运工收益总与中继链收益总和</h2>
                    </div>
                </div>
            </div>
            <!--/.row-->
        </div>
        <!--/.container-->
    </div>
    <!--/.banner-section-->

    <!-- 20220718 blockheader-->
    <section class="bg-deep about-content-section">
        <div id="block">
            <div class="container">
                <div class="row row-eq-height" style="margin-bottom: 60px;">
                    <div class="col-md-12">
                        <el-table :data="blockHeaderList.slice((currentBlockPage-1)*pageSize,currentBlockPage*pageSize)"
                            style="width: 100%">
                            <!-- 20220719
                            <el-table-column prop="version" label="version"></el-table-column>
                            <el-table-column prop="hashMerkleRoot" label="hashMerkleRoot"></el-table-column>
                            <el-table-column prop="bits" label="bits"></el-table-column>
                            <el-table-column prop="nonce" label="nonce"></el-table-column>
                            <el-table-column prop="score" label="score"></el-table-column>
                             -->
                            <el-table-column prop="type" label="type" column-key="type"
                                :filters="[{text: 'BTC', value: 'BTC'},{text: 'ETH', value: 'ETH'},
                                            {text: 'LTC', value: 'LTC'},{text: 'ATOM', value: 'ATOM'},
                                            {text: 'DCR', value: 'DCR'},{text: 'DOGE', value: 'DOGE'}]" :filter-method="filterHandler">
                            </el-table-column>
                            <el-table-column prop="hashPrevBlock" label="hashPrevBlock" width="200" min-width="280" 
                            :show-overflow-tooltip="true"></el-table-column>
                            <el-table-column prop="hashBlock" label="hashBlock" width="200" min-width="280" 
                            :show-overflow-tooltip="true"></el-table-column>
                            <el-table-column prop="time" label="time" width="95"></el-table-column>
                            <el-table-column prop="height" label="height"></el-table-column>
                            <el-table-column prop="relayer" label="relayer" min-width="280" 
                            :show-overflow-tooltip="true"></el-table-column>
                            <el-table-column prop="ifConfirm" label="ifConfirm"></el-table-column>
                        </el-table>
                        <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange_block"
                            :current-page="currentBlockPage" :page-sizes="[10, 20, 30, 50, 100]" :page-size="pageSize"
                            layout="total, sizes, prev, pager, next, jumper" :total="blockHeaderList.length">
                        </el-pagination>
                    </div>
                </div>
                <!--/.row-->
            </div>
        </div>
        <!--/.container-->
    </section>
    <!--/.about-section-->

    <section class="section-padding">
        <div class="container">
            <div class="col-md-6 col-sm-12">
                <div class="about-inner">
                    <div>
                        <div class="pie">
                            <div id="pie1">
                                <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
                                <div id="main1" style="float:left;width:100%;height: 400px"></div>
                            </div>
                        </div>
                    </div>
                    
                    <script>// 引入基本模板
                        // 基于准备好的dom，初始化echarts实例
                        var myPieChart = echarts.init(document.getElementById('main1'));
                        var fee = {};
                        // 绘制图表
                        myPieChart.setOption({
                            title : {
                                text: '异构链贡献图',//主标题
                                // subtext: '纯属虚构',//副标题
                                x:'center',//x轴方向对齐方式
                            },
                            tooltip : {
                                trigger: 'item',
                                formatter: "{a} <br/>{b} : {c} ({d}%)"
                            },
                            legend: {
                                orient: 'vertical',
                                bottom: 'bottom',
                                data: ['BTC','ETH','LTC','ATOM','DCR','DOGE']
                            },
                            series : [
                                {
                                    name: '代币名称',
                                    type: 'pie',
                                    radius : '55%',
                                    center: ['50%', '60%'],
                                    data:[
                                        {value:0, name:'BTC'},
                                        {value:0, name:'ETH'},
                                        {value:0, name:'LTC'},
                                        {value:0, name:'ATOM'},
                                        {value:0, name:'DCR'},
                                        {value:0, name:'DOGE'},
                                    ],
                                    itemStyle: {
                                        emphasis: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                        }
                                    }
                                }
                            ],
                        });
                        
                        myPieChart.showLoading();
                        vv = window.setInterval("updatePieChart()", 2000);
                        
                        // 周期性更新
                        function updatePieChart(){                           
                            var httpRequest = new XMLHttpRequest();
                            httpRequest.open('GET','http://localhost/updateChart',true);
                            httpRequest.send();
                            httpRequest.onreadystatechange = function() {
                                if(httpRequest.readyState == 4 && httpRequest.status == 200){
                                    fee = JSON.parse(httpRequest.responseText);
                                    // update
                                    myPieChart.hideLoading();
                                    var avg_btc = fee.Bitcoin.blockNumber === 0 ? 0 : fee.Bitcoin.f/fee.Bitcoin.blockNumber;
                                    var avg_eth = fee.Ethereum.blockNumber === 0 ? 0 : fee.Ethereum.f/fee.Ethereum.blockNumber;
                                    var avg_ltc = fee.Litecoin.blockNumber === 0 ? 0 : fee.Litecoin.f/fee.Litecoin.blockNumber;
                                    var avg_atom = fee.Cosmos.blockNumber === 0 ? 0 : fee.Cosmos.f/fee.Cosmos.blockNumber;
                                    var avg_dcr = fee.Decred.blockNumber === 0 ? 0 : fee.Decred.f/fee.Decred.blockNumber;
                                    var avg_doge = fee.Dogecoin.blockNumber === 0 ? 0 : fee.Dogecoin.f/fee.Dogecoin.blockNumber;
                                    myPieChart.setOption({
                                        title : {
                                            text: '异构链贡献图',//主标题
                                            x:'center',//x轴方向对齐方式
                                        },
                                        tooltip : {
                                            trigger: 'item',
                                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                                        },
                                        legend: {
                                            orient: 'vertical',
                                            bottom: 'bottom',
                                            data: ['BTC','ETH','LTC','ATOM','DCR','DOGE']
                                        },
                                        series : [
                                            {
                                                name: '代币名称',
                                                type: 'pie',
                                                radius : '55%',
                                                center: ['50%', '60%'],
                                                data:[
                                                    {value: avg_btc.toFixed(2), name:'BTC'},
                                                    {value: avg_eth.toFixed(2), name:'ETH'},
                                                    {value: avg_ltc.toFixed(2), name:'LTC'},
                                                    {value: avg_atom, name:'ATOM'},
                                                    {value: avg_dcr, name:'DCR'},
                                                    {value: avg_doge.toFixed(2), name:'DOGE'},
                                                ],
                                                itemStyle: {
                                                    emphasis: {
                                                        shadowBlur: 10,
                                                        shadowOffsetX: 0,
                                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                                    },
                                                }
                                            }
                                        ],
                                    });
                                }
                            }
                        }

                    </script>
                </div>
                <!--/.about-inner-->
            </div>
            
            <div class="col-md-6 col-sm-12">
                <div class="about-inner">
                    <div id="main3" style="width: 600px;height:400px;"></div>
                    <script type="text/javascript">
                        // 基于准备好的dom，初始化echarts实例
                        var myChart = echarts.init(document.getElementById('main3'));
                        var fee = {};
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                text: '搬运工预期收益图'
                            },
                            tooltip: {},
                            legend: {
                                data:['收益']
                            },
                            xAxis: {
                                data: ['BTC','ETH','LTC','ATOM','DCR','DOGE'] 
                            },
                            yAxis: {},
                            series: [{
                                name: '收益',
                                type: 'bar',
                                data: [0,0,0,0,0,0]
                            }],
                        };
                
                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                        myChart.showLoading();

                        v = window.setInterval("updateColumnChart()", 2000);
                        
                        // 周期性更新
                        function updateColumnChart(){                           
                            var httpRequest = new XMLHttpRequest();
                            httpRequest.open('GET','http://localhost/updateChart',true);
                            httpRequest.send();
                            httpRequest.onreadystatechange = function() {
                                if(httpRequest.readyState == 4 && httpRequest.status == 200){
                                    fee = JSON.parse(httpRequest.responseText);
                                    // console.log('fee:',fee)
                                    myChart.hideLoading();
                                    // calculate by propotion
                                    var avg_btc = fee.Bitcoin.blockNumber === 0 ? 0 : fee.Bitcoin.f/fee.Bitcoin.blockNumber;
                                    var avg_eth = fee.Ethereum.blockNumber === 0 ? 0 : fee.Ethereum.f/fee.Ethereum.blockNumber;
                                    var avg_ltc = fee.Litecoin.blockNumber === 0 ? 0 : fee.Litecoin.f/fee.Litecoin.blockNumber;
                                    var avg_atom = fee.Cosmos.blockNumber === 0 ? 0 : fee.Cosmos.f/fee.Cosmos.blockNumber;
                                    var avg_dcr = fee.Decred.blockNumber === 0 ? 0 : fee.Decred.f/fee.Decred.blockNumber;
                                    var avg_doge = fee.Dogecoin.blockNumber === 0 ? 0 : fee.Dogecoin.f/fee.Dogecoin.blockNumber;
                                    var sum = avg_btc + avg_eth + avg_ltc + avg_atom + avg_dcr + avg_doge;
                                    var prop_btc = sum === 0 ? 0 : avg_btc/sum;
                                    var prop_eth = sum === 0 ? 0 : avg_eth/sum;
                                    var prop_ltc = sum === 0 ? 0 : avg_ltc/sum;
                                    var prop_atom = sum === 0 ? 0 : avg_atom/sum;
                                    var prop_dcr = sum === 0 ? 0 : avg_dcr/sum;
                                    var prop_doge = sum === 0 ? 0 : avg_doge/sum;
                                    var bignum = 500;
                                    // update
                                    myChart.setOption({
                                        title: {
                                            text: '搬运工预期收益图'
                                        },
                                        tooltip: {},
                                        legend: {
                                            data:['收益']
                                        },
                                        xAxis: {
                                            data: ['BTC','ETH','LTC','ATOM','DCR','DOGE'] 
                                        },
                                        yAxis: {},
                                        series: [{
                                            name: '收益',
                                            type: 'bar',
                                            data: [
                                            (prop_btc * bignum).toFixed(2),
                                            (prop_eth * bignum).toFixed(2),
                                            (prop_ltc * bignum).toFixed(2),
                                            (prop_atom * bignum).toFixed(2),
                                            (prop_dcr * bignum).toFixed(2),
                                            (prop_doge * bignum).toFixed(2)
                                            ]
                                        }],
                                        label: {
                                            show: true,
                                            color: 'black',
                                            position: 'top',
                                        }
                                    });
                                }
                            }
                        }
                    </script>
                </div>
                <!--/.about-inner-->
            </div>
        </div>
        <!--/.container-->
    </section>

    <section class="section-padding">
        <div id="node">
            <div class="container">
                <div class="col-md-12">
                    <el-table :data="nodeList" style="width: 100%" max-height="400" :default-sort = "{prop: 'carryNumber', order: 'descending'}">
                        <el-table-column type="index" width="50"></el-table-column>
                        <el-table-column prop="nodeAddr" label="Address" min-width="280" 
                        :show-overflow-tooltip="true"></el-table-column>
                        <el-table-column prop="carryNumber" label="CarryNumber"></el-table-column>
                    </el-table>
                </div>
            </div>
        </div>
        <!--/.container-->
    </section>

    <section class="footer-area">
        <div class="container">
            <div class="row footer-banner row-eq-height">
                <div class="col-md-6 col-sm-6">
                    <div class="footer-content">
                        <div class="footer-logo">
                            <a href="/"><img src="/public/images/footer-logo.png" alt=""></a>
                        </div>
                        <div class="text-content">
                            <p>本平台致力于打造全球规模最大的暗池交易系统</p>
                            <p>加入CryptoPool，成为我们的一员</p>
                        </div>
                    </div>
                    <!--/.footer-content-->
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="footer-content">
                        <h4><a href="#">最近要闻</a></h4>
                        <ul>
                            <li><a href="#">平台动态</a></li>
                            <li><a href="#">市场快报</a></li>
                            <li><a href="#">投资建议</a></li>
                            <li><a href="#">商业合作</a></li>
                        </ul>
                    </div>
                    <!--/.footer-content-->
                </div>
                <div class="col-md-3 col-sm-6 col-xs-6">
                    <div class="footer-content">
                        <h4><a href="#">友情链接</a></h4>
                        <ul>
                            <li><a href="/public/tutorial.html">快速入门</a></li>
                            <li><a href="/public/kline/basic.html">查看行情</a></li>
                            <li><a href="/public/block_explorer.html">区块浏览</a></li>
                            <li><a href="#">联系我们</a></li>
                        </ul>
                    </div>
                    <!--/.footer-content-->
                </div>
            </div>
            <!--/.rwo footer-banner-->
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 col-sm-6">
                        <div class="copyright-info">
                            <p>Copyright &copy; 2021.CryptoPool All rights reserved.</p>
                        </div>
                    </div>
                    <!--/.copyright-info-->
                    <div class="col-md-6 col-sm-6">
                        <div class="social text-right content-align">
                            <ul>
                                <li><a href="#"><i><img src="/public/images/footer/wechat.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/alipay.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/weibo.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/facebook.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/twitter.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                                <li><a href="#"><i><img src="/public/images/footer/ins.png"
                                                style="height: 18px; width: 18px;"></i></a></li>
                            </ul>
                        </div>
                        <!--/.social-->
                    </div>
                </div>
            </div>
            <!--/.copyright-->
        </div>
        <!--/.contianer-->
    </section>
    <!--/.footer area-->

    <!-- Vue -->
    <script>
        // 区块头
        var bh = new Vue({
            el: "#block",
            delimiters: ["{[", "]}"],
            data: {
                blockHeaderList : [],
                // 控制参数
                currentPage: 1, // 查询结果当前页
                currentBlockPage: 1,
                pageSize: 10, // 查询结果每页多少条
            },
            methods: {
                filterHandler(value, row, column) {
                    const property = column['property'];
                    return row[property] === value;
                },
                // 每页多少条
                handleSizeChange(val) {
                    this.pageSize = val;
                },
                // 当前页
                handleCurrentChange_block(val) {
                    this.currentBlockPage = val;
                },
            },
            created: function () {
                var that = this;
                axios.post('/getBlockHeader').then(function (res) {
                            var data = res.data;
                            that.blockHeaderList = data['blockHeaderList'];
                            that.blockHeaderList.reverse();
                        }).catch(function (err) {
                            console.log("=err====" + err);
                        })
                // setInterval不会清除定时器队列，每重复执行1次都会导致定时器叠加 \
                window.setInterval(() => {
                    // setTimeout是自带清除定时器
                    setTimeout(function () {
                        axios.post('/getBlockHeader').then(function (res) {
                            var data = res.data;
                            that.blockHeaderList = data['blockHeaderList'];
                            that.blockHeaderList.reverse();
                        }).catch(function (err) {
                            console.log("=err====" + err);
                        })
                    }, 2000)
                }, 2000)
            }
        });

        // 搬运工
        var nd = new Vue({
            el: "#node",
            delimiters: ["{[", "]}"],
            data: {
                nodeList: [], // 搬运工列表
            },
            methods: {
                getNodeList(){
                    axios.get('/getNodeList').then(Response =>{
                        this.nodeList = Response['data']['nodeList'];
                    })
                }
            },
            created: function(){
                var that = this;
                axios.post('/updateCarryNum').then(function (res) {
                            var data = res.data;
                            that.nodeList = data['nodeList'];
                        }).catch(function (err) {
                            console.log("=err====" + err);
                        })
                // setInterval不会清除定时器队列，每重复执行1次都会导致定时器叠加 \
                window.setInterval(() => {
                    // setTimeout是自带清除定时器
                    setTimeout(function () {
                        axios.post('/updateCarryNum').then(function (res) {
                            var data = res.data;
                            that.nodeList = data['nodeList'];
                        }).catch(function (err) {
                            console.log("=err====" + err);
                        })
                    }, 2000)
                }, 2000)
            }
        })
    </script>

    <!--Preloader-->
    <!-- == jQuery Librery == -->
    <script src="/public/js/jquery-3.3.1.min.js"></script>
    <!-- == Bootsrap js File == -->
    <script src="/public/js/bootstrap.min.js"></script>
    <!-- == wow min js == -->
    <script src="/public/js/wow.min.js"></script>
    <!-- == Custom Menu js == -->
    <script src="/public/js/custom-menu.js"></script>
    <!-- == Custom Counter js == -->
    <script src="/public/js/custom-counter.js"></script>
    <script src="/public/js/prallex.js"></script>
    <!-- == Owl Carousel  == -->
    <script src="/public/js/owl.carousel.min.js"></script>
    <script src="/public/js/Chart.min.js"></script>
    <!-- == Custom js  == -->
    <script src="/public/js/custom.js"></script>
    <script>

        var canvas = document.getElementById('myChart');

        var data = {
            labels: ["Saturday", "Sunday", "Mon", "Tues", "Wednes", "Thurs", "Friday"],
            datasets: [
                {
                    label: "Business Goal Statistics",
                    backgroundColor: "rgba(255,206,0,1)",
                    borderColor: "rgba(255,206,0,1)",
                    borderWidth: 2,
                    hoverBackgroundColor: "rgba(255,206,0,1)",
                    hoverBorderColor: "rgba(255,206,0,1)",
                    data: [5, 7, 4, 8, 6, 5, 4],
                },
            ]
        };
        var option = {
            scales: {
                yAxes: [{
                    ticks: {
                        max: 10,
                        stepSize: 1
                    },
                    stacked: true,
                    gridLines: {
                        borderDash: 8,
                        stroke: true
                    }
                }],
                xAxes: [{
                    stacked: true,
                    gridLines: {
                        display: true,
                    }
                }]
            }
        };

        var myBarChart = Chart.Bar(canvas, {
            data: data,
            options: option
        });
    </script>
</body>

</html>